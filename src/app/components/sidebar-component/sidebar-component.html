<!-- Desktop / tablet sidebar -->
<aside class="hidden h-dvh w-64 border-r border-zinc-200 bg-white text-zinc-900 md:block">
  <div class="flex h-full flex-col px-4 py-5">
    <!-- Top: Logo + Name -->
    <a
      routerLink="/home"
      class="group flex items-center gap-3 rounded-xl px-3 py-2 hover:bg-zinc-100 transition"
    >
      <div class="grid h-10 w-10 place-items-center rounded-xl bg-zinc-900 text-white shadow-sm">
        <svg viewBox="0 0 24 24" class="h-5 w-5">
          <path
            fill="currentColor"
            d="M12 2l9 5v10l-9 5-9-5V7l9-5Zm0 2.3L5 8v8l7 3.7L19 16V8l-7-3.7Z"
          />
        </svg>
      </div>

      <div class="text-xl font-bold">{{ appName }}</div>
    </a>

    <!-- Middle spacer -->
    <div class="flex-1"></div>

    <!-- Bottom: Nav buttons (without Profile) -->
    <nav class="space-y-1">
      @for (item of nav; track trackByPath($index, item)) {
      <a
        [routerLink]="item.path"
        routerLinkActive="bg-zinc-100 text-zinc-900"
        [routerLinkActiveOptions]="{ exact: false }"
        class="group flex items-center gap-3 rounded-xl px-3 py-2 text-sm font-medium text-zinc-600 hover:bg-zinc-100 hover:text-zinc-900 transition"
      >
        <!-- Icon -->
        <span
          class="grid h-9 w-9 place-items-center rounded-lg border border-zinc-200 bg-white group-hover:bg-zinc-50"
        >
          <lucide-icon [name]="item.icon" class="h-5 w-5"></lucide-icon>
        </span>

        <span class="truncate">{{ item.label }}</span>

        <!-- Active indicator dot -->
        <span
          class="ml-auto h-2 w-2 rounded-full bg-transparent group-[.bg-zinc-100]:bg-zinc-900"
          aria-hidden="true"
        ></span>
      </a>
      } @if (isAdmin) {
      <a
        [routerLink]="'/manage-universities'"
        routerLinkActive="bg-zinc-100 text-zinc-900"
        class="group flex items-center gap-3 rounded-xl px-3 py-2 text-sm font-medium text-zinc-600 hover:bg-zinc-100 hover:text-zinc-900 transition"
      >
        <!-- Icon -->
        <span
          class="grid h-9 w-9 place-items-center rounded-lg border border-zinc-200 bg-white group-hover:bg-zinc-50"
        >
          <lucide-icon name="university" class="h-5 w-5"></lucide-icon>
        </span>

        <span class="truncate">Manage Universities</span>

        <!-- Active indicator dot -->
        <span
          class="ml-auto h-2 w-2 rounded-full bg-transparent group-[.bg-zinc-100]:bg-zinc-900"
          aria-hidden="true"
        ></span>
      </a>
      }
    </nav>

    <!-- Profile button (separated from nav) -->
    <div class="mt-4 border-t border-zinc-200 pt-4">
      @if (auth.profile$ | async; as profile) {
      <button
        type="button"
        (click)="toggleProfileMenu()"
        class="group flex w-full items-center gap-3 rounded-xl px-3 py-2 text-sm hover:bg-zinc-100 transition"
      >
        <!-- Avatar -->
        @if (profile.photoURL) {
        <img
          [src]="profile.photoURL"
          alt="Profile photo"
          class="h-8 w-8 rounded-full object-cover"
          referrerpolicy="no-referrer"
        />
        } @else {
        <div
          class="grid h-8 w-8 place-items-center rounded-full bg-zinc-900 text-xs font-semibold text-white"
        >
          {{ profile.name ? profile.name.charAt(0).toUpperCase() : '?' }}
        </div>
        }

        <!-- Name + secondary text -->
        <div class="flex min-w-0 flex-col text-left">
          <span class="truncate text-sm font-semibold text-zinc-900">
            {{ profile.name || 'My Profile' }}
          </span>
          <span class="truncate text-xs text-zinc-500">
            {{ profile.email || 'View & edit profile' }}
          </span>
        </div>

        <!-- Chevron -->
        <svg viewBox="0 0 24 24" class="ml-auto h-7 w-7 text-zinc-400 group-hover:text-zinc-600">
          <path fill="currentColor" d="M8.7 9.3 10.1 8l4 4-4 4-1.4-1.4L11.3 12 8.7 9.3Z" />
        </svg>
      </button>
      } @else {
      <!-- Fallback while loading / no profile -->
      <button
        type="button"
        (click)="toggleProfileMenu()"
        class="flex w-full items-center gap-3 rounded-xl px-3 py-2 text-sm text-zinc-600 hover:bg-zinc-100 transition"
      >
        <div
          class="grid h-8 w-8 place-items-center rounded-full bg-zinc-200 text-xs font-semibold text-zinc-500"
        >
          ?
        </div>
        <div class="flex flex-col text-left">
          <span class="text-sm font-semibold text-zinc-900">My Profile</span>
          <span class="text-xs text-zinc-500">View options</span>
        </div>
      </button>
      }
    </div>
  </div>
</aside>

<!-- Mobile bottom nav -->
<nav
  class="fixed inset-x-0 bottom-0 z-30 border-t border-zinc-200 bg-white/95 backdrop-blur md:hidden"
>
  <div class="mx-auto flex max-w-md items-stretch justify-around">
    @for (item of nav; track trackByPath($index, item)) {
    <a
      [routerLink]="item.path"
      routerLinkActive="text-zinc-900"
      [routerLinkActiveOptions]="{ exact: false }"
      class="flex flex-1 flex-col items-center justify-center gap-1 py-2 text-xs font-medium text-zinc-500 hover:text-zinc-900 transition"
    >
      <span class="grid h-8 w-8 place-items-center rounded-full">
        <lucide-icon [name]="item.icon" class="h-5 w-5"></lucide-icon>
      </span>
      <span class="truncate">{{ item.short_label }}</span>
    </a>
    } @if(isAdmin){
    <a
      [routerLink]="'/manage-universities'"
      routerLinkActive="text-zinc-900"
      class="flex flex-1 flex-col items-center justify-center gap-1 py-2 text-xs font-medium text-zinc-500 hover:text-zinc-900 transition"
    >
      <span class="grid h-8 w-8 place-items-center rounded-full">
        <lucide-icon name="university" class="h-5 w-5"></lucide-icon>
      </span>
      <span class="truncate">Manage</span>
    </a>
    }

    <!-- Mobile profile button -->
    <button
      type="button"
      (click)="toggleProfileMenu()"
      class="flex flex-1 flex-col items-center justify-center gap-1 py-2 text-xs font-medium text-zinc-500 hover:text-zinc-900 transition"
    >
      @if (auth.profile$ | async; as profile) { @if (profile.photoURL) {
      <img
        [src]="profile.photoURL"
        alt="Profile photo"
        class="h-8 w-8 rounded-full object-cover"
        referrerpolicy="no-referrer"
      />
      } @else {
      <div
        class="grid h-8 w-8 place-items-center rounded-full bg-zinc-900 text-[10px] font-semibold text-white"
      >
        {{ profile.name ? profile.name.charAt(0).toUpperCase() : '?' }}
      </div>
      } } @else {
      <div
        class="grid h-8 w-8 place-items-center rounded-full bg-zinc-200 text-[10px] font-semibold text-zinc-500"
      >
        ?
      </div>
      }
      <span class="truncate">Profile</span>
    </button>
  </div>
</nav>

<!-- Profile overlay (desktop + mobile) -->
@if (showProfileMenu) {
<div class="fixed inset-0 z-40 bg-black/20" (click)="closeProfileMenu()">
  <!-- Panel positioned near bottom-left on desktop, centered-ish on mobile -->
  <div
    class="absolute bottom-20 left-1/2 w-64 max-w-[calc(100%-2rem)] -translate-x-1/2 rounded-xl border border-zinc-200 bg-white p-3 shadow-lg md:bottom-24 md:left-4 md:w-64 md:max-w-none md:translate-x-0"
    (click)="$event.stopPropagation()"
  >
    <button
      type="button"
      (click)="goToProfile()"
      class="flex w-full items-center justify-between rounded-lg px-3 py-2 text-sm font-medium text-zinc-700 hover:bg-zinc-100"
    >
      <span>Edit profile</span>
      <svg viewBox="0 0 24 24" class="h-4 w-4 text-zinc-400">
        <path fill="currentColor" d="M8.7 9.3 10.1 8l4 4-4 4-1.4-1.4L11.3 12 8.7 9.3Z" />
      </svg>
    </button>

    <button
      type="button"
      (click)="logout()"
      class="mt-2 flex w-full items-center justify-between rounded-lg px-3 py-2 text-sm font-medium text-red-600 hover:bg-red-50"
    >
      <span>Log out</span>
      <svg viewBox="0 0 24 24" class="h-4 w-4">
        <path
          fill="currentColor"
          d="M10 4a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1h-8a1 1 0 0 1-1-1v-3h2v2h6V5h-6v2h-2V4Zm-1.7 6.3 1.4-1.4L13 11.6V8h2v8h-2v-3.6l-3.3 2.7-1.4-1.4L10.6 12 8.3 10.3Z"
        />
      </svg>
    </button>
  </div>
</div>
}
