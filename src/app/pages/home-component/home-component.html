<div class="flex min-h-screen flex-col bg-linear-to-b from-zinc-50 to-white">
  <!-- Hero -->
  <header class="border-b border-zinc-200 bg-white/80 backdrop-blur">
    <div class="mx-auto flex max-w-6xl items-center justify-between px-4 py-4">
      <div class="flex items-center gap-3">
        <div class="grid h-9 w-9 place-items-center rounded-xl bg-zinc-900 text-white shadow-sm">
          <svg viewBox="0 0 24 24" class="h-5 w-5">
            <path
              fill="currentColor"
              d="M12 2l9 5v10l-9 5-9-5V7l9-5Zm0 2.3L5 8v8l7 3.7L19 16V8l-7-3.7Z"
            />
          </svg>
        </div>
        <div>
          <h1 class="text-xl font-semibold text-zinc-900">PaperHub</h1>
          <p class="text-xs text-zinc-500">
            Community-driven hub for past-year papers and structured questions.
          </p>
        </div>
      </div>

      <div class="hidden gap-2 md:flex">
        <a
          routerLink="/contribute-paper"
          class="rounded-lg border border-zinc-200 px-3 py-1.5 text-xs font-medium text-zinc-700 hover:bg-zinc-50"
        >
          Contribute paper
        </a>
        <a
          routerLink="/workspace"
          class="rounded-lg bg-zinc-900 px-3 py-1.5 text-xs font-medium text-white hover:bg-zinc-800"
        >
          My workspace
        </a>
      </div>
    </div>
  </header>

  <!-- Main content -->
  <main class="mx-auto flex w-full max-w-6xl flex-1 flex-col gap-6 px-4 py-8">
    <!-- Title + description -->
    <section class="space-y-3">
      <h2 class="text-3xl font-bold tracking-tight text-zinc-900">
        Practice smarter with shared exam papers.
      </h2>
      <p class="max-w-2xl text-sm text-zinc-600">
        Browse published exam papers contributed by the community. Search by course, code, or
        university, then preview questions and save them into your workspace to start answering.
      </p>
    </section>

    <!-- Search bar -->
    <section class="mt-2 flex flex-col gap-3">
      <div
        class="flex items-center gap-2 rounded-xl border border-zinc-200 bg-white px-3 py-2 shadow-sm"
      >
        <svg viewBox="0 0 24 24" class="h-4 w-4 text-zinc-400">
          <path
            fill="currentColor"
            d="M10 4a6 6 0 0 1 4.8 9.6l3.8 3.8-1.4 1.4-3.8-3.8A6 6 0 1 1 10 4Zm0 2a4 4 0 1 0 0 8 4 4 0 0 0 0-8Z"
          />
        </svg>
        <input
          type="text"
          placeholder="Search by course name, course code, or university…"
          [ngModel]="searchTerm()"
          (ngModelChange)="onSearch($event)"
          class="w-full border-none bg-transparent text-sm text-zinc-800 outline-none placeholder:text-zinc-400"
        />
      </div>

      @if (error()) {
      <p class="text-sm text-red-500">{{ error() }}</p>
      }
    </section>

    <!-- Grid of published papers -->
    <section class="relative mt-2 flex-1">
      @if (!loading() && filteredPapers().length === 0) {
      <div
        class="flex h-60 flex-col items-center justify-center rounded-xl border border-dashed border-zinc-200 bg-zinc-50 text-center text-sm text-zinc-500"
      >
        <p>No published papers found.</p>
        <p class="mt-1 text-xs">
          Try a different search term or be the first to
          <a routerLink="/contribute-paper" class="font-medium text-zinc-900 underline">
            contribute a paper </a
          >.
        </p>
      </div>
      } @else {
      <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4">
        @for (p of filteredPapers(); track p.id) {
        <app-paper-card [paper]="p" (paperClick)="openPaperPreview(p)"></app-paper-card>
        }
      </div>
      } @if (loading()) {
      <div
        class="absolute inset-0 z-10 flex items-center justify-center rounded-xl bg-white/80 backdrop-blur-sm"
      >
        <div
          class="flex flex-col items-center gap-3 rounded-2xl border border-zinc-200 bg-white px-6 py-4 shadow-lg"
        >
          <span
            class="h-8 w-8 animate-spin rounded-full border-2 border-zinc-300 border-t-zinc-900"
          ></span>
          <p class="text-sm text-zinc-600">Loading published papers…</p>
        </div>
      </div>
      }
    </section>
  </main>

  <!-- Preview & save-to-workspace modal -->
  @if (showPreviewDialog() && activePaper()) {
  <div class="fixed inset-0 z-40 flex items-center justify-center bg-black/30 backdrop-blur-sm">
    <div
      class="flex w-full max-w-4xl flex-col rounded-2xl border border-zinc-200 bg-white p-5 shadow-xl"
    >
      <div class="mb-3 flex items-center justify-between">
        <div>
          <h2 class="text-sm font-semibold text-zinc-900">
            {{ activePaper()!.courseCode }}: {{ activePaper()!.courseName }}
          </h2>
          <p class="text-xs text-zinc-500">
            Preview questions and optionally save them to your workspace.
          </p>
        </div>
        <button
          type="button"
          (click)="closePreviewDialog()"
          class="text-xs text-zinc-500 hover:text-zinc-700"
        >
          Close
        </button>
      </div>

      <div class="max-h-115 space-y-3 overflow-auto pr-1">
        @for (q of activePaper()!.questions; track q.question_number) {
        <div class="rounded-lg border border-zinc-200 bg-white p-3">
          <div class="mb-1 flex items-center justify-between">
            <span class="text-xs font-semibold text-zinc-500">
              Question {{ q.question_number }}
            </span>
            @if (q.marks !== undefined && q.marks !== null) {
            <span class="text-xs text-zinc-500">{{ q.marks }} marks</span>
            }
          </div>
          <p class="mb-2 text-sm text-zinc-800 whitespace-pre-line">
            {{ q.text }}
          </p>

          @if (q.sub_questions?.length) {
          <div class="mt-1 space-y-1 border-t border-zinc-100 pt-2">
            @for (sq of q.sub_questions; track sq.sub_number) {
            <div class="text-xs text-zinc-700">
              <span class="font-semibold">{{ sq.sub_number }}.</span>
              <span class="ml-1 whitespace-pre-line">{{ sq.text }}</span>
            </div>
            }
          </div>
          }
        </div>
        }
      </div>

      <div class="mt-4 flex justify-end">
        <button
          type="button"
          (click)="saveToWorkspaceFromHome()"
          [disabled]="!isLoggedIn || savingToWorkspace()"
          class="rounded-lg bg-zinc-900 px-4 py-2 text-xs font-medium text-white disabled:cursor-not-allowed disabled:opacity-60"
        >
          {{ savingToWorkspace() ? 'Saving…' : 'Save to workspace' }}
        </button>
      </div>
    </div>
  </div>
  }
</div>
